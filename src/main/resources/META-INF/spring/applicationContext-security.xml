<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

  xmlns:beans="http://www.springframework.org/schema/beans"
  xmlns="http://www.springframework.org/schema/security"

  xsi:schemaLocation="http://www.springframework.org/schema/beans
                      http://www.springframework.org/schema/beans/spring-beans.xsd

                      http://www.springframework.org/schema/security
                      http://www.springframework.org/schema/security/spring-security.xsd">

  <http pattern="/captcha.jpg" create-session="stateless" security="none">
  </http>

  <http pattern="/rest/feedbacks" create-session="stateless" entry-point-ref="http403EntryPoint">
    <custom-filter position="PRE_AUTH_FILTER" ref="siteminderFilter" />
  </http>

  <beans:bean id="siteminderFilter" class="ru.sbrf.qrcode.security.CaptchaAuthenticationFilter">
    <beans:property name="authenticationManager" ref="authenticationManager" />
  </beans:bean>

  <authentication-manager alias="authenticationManager">
    <authentication-provider ref="preauthAuthProvider" />
  </authentication-manager>

  <beans:bean id="preauthAuthProvider" class="org.springframework.security.web.authentication.preauth.PreAuthenticatedAuthenticationProvider">
    <beans:property name="preAuthenticatedUserDetailsService">
      <beans:bean class="ru.sbrf.qrcode.security.PreAuthenticatedGrantedAuthoritiesUserDetailsService"/>
    </beans:property>
  </beans:bean>

  <beans:bean id="http403EntryPoint" class="org.springframework.security.web.authentication.Http403ForbiddenEntryPoint"/>

</beans:beans>